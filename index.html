<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุงููุญุงุณุจ</title>
    <style>
        :root { --main: #1e293b; --accent: #0284c7; --bg: #f8fafc; --white: #ffffff; --danger: #be123c; --success: #059669; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; color: #334155; }
        header { background: var(--main); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo-img { width: 40px; height: 40px; background: var(--accent); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .page { display: none; padding: 25px; }
        .page.active { display: block; }
        .table-container { background: var(--white); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f1f5f9; padding: 12px; border: 1px solid #e2e8f0; font-size: 13px; color: var(--main); }
        td { padding: 8px; border: 1px solid #e2e8f0; text-align: center; }
        input, select { width: 92%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 14px; }
        input[readonly] { background-color: #f1f5f9; color: #64748b; cursor: not-allowed; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-save { background: var(--success); color: white; }
        .btn-del { background: var(--danger); color: white; }
        .btn-add { background: var(--main); color: white; margin-bottom: 15px; }
        .nav-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; text-align: center; cursor: pointer; border: 1px solid #e2e8f0; transition: 0.3s; }
        .card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .auth-box { max-width: 400px; margin: 80px auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); text-align: center; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #f1f5f9; }
        .tab { flex: 1; padding: 10px; cursor: pointer; font-weight: bold; color: #94a3b8; }
        .tab.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        #loader { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:9999; justify-content:center; align-items:center; flex-direction:column; }
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .total-row { background: #f8fafc; font-weight: bold; }
        .info-box { background: #fffbeb; border-right: 5px solid #f59e0b; padding: 15px; margin-bottom: 15px; text-align: right; border-radius: 4px; }
        .info-box h4 { margin-top: 0; color: #92400e; }
        .info-box ul { padding-right: 20px; }
        .info-box li { margin-bottom: 8px; line-height: 1.6; }
    </style>
</head>
<body>
<div id="loader"><b>โณ ุฌุงุฑู ุงูุงุชุตุงู...</b></div>
<div id="authScreen" class="auth-box">
    <div class="logo-img" style="margin: 0 auto 20px; width: 60px; height: 60px; font-size: 30px;">๐</div>
    <div class="tabs">
        <div id="loginTab" class="tab active" onclick="switchAuth(true)">ุชุณุฌูู ุงูุฏุฎูู</div>
        <div id="registerTab" class="tab" onclick="switchAuth(false)">ุฅูุดุงุก ุญุณุงุจ</div>
    </div>
    <input type="text" id="username" placeholder="ุงุณู ุงููุณุชุฎุฏู" style="margin-bottom:15px; width:100%;">
    <input type="password" id="password" placeholder="ูููุฉ ุงููุฑูุฑ" style="margin-bottom:5px; width:100%;">
    <p style="font-size: 11px; color: var(--danger); margin-bottom: 10px;">* ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ูุง ุชูู ุนู 6 ุฃุญุฑู ุฃู ุฃุฑูุงู</p>
    <button class="btn btn-save" style="width:100%" onclick="processAuth()">ุฏุฎูู</button>
</div>
<div id="appScreen" style="display:none;">
    <header>
        <div style="display:flex; align-items:center; gap:12px;"><div class="logo-img">๐</div><h2 style="margin:0">ุงููุญุงุณุจ</h2></div>
        <div style="display:flex; align-items:center; gap:15px;">
            <span id="userDisplay" style="font-weight: bold;"></span>
            <button class="btn btn-save" onclick="syncToCloud()" style="background:var(--success)">ุญูุธ ุงูุจูุงูุงุช</button>
            <button class="btn btn-del" onclick="logout()">ุฎุฑูุฌ</button>
        </div>
    </header>
    <div id="homePage" class="page active">
        <div class="nav-menu">
            <div class="card" onclick="openPage('accountsPage')"><h3>๐ ุงูุญุณุงุจุงุช</h3></div>
            <div class="card" onclick="openPage('journalPage')"><h3>๐ ุงูููููุฉ</h3></div>
            <div class="card" onclick="openPage('productsPage')"><h3>๐ฆ ุงููุฎุฒู</h3></div>
            <div class="card" onclick="openPage('partnersPage')"><h3>๐ค ุงููุชุนุงูููู</h3></div>
            <div class="card" onclick="openPage('trialPage')"><h3>โ๏ธ ุงูููุฒุงู</h3></div>
            <div class="card" onclick="openPage('incomePage')" style="background: #f0fdf4;"><h3>๐ ูุงุฆูุฉ ุงูุฏุฎู</h3></div>
            <div class="card" onclick="openPage('balanceSheetPage')" style="background: #eff6ff;"><h3>๐ฆ ุงููุฑูุฒ ุงููุงูู</h3></div>
            <div class="card" onclick="openPage('guidePage')" style="background: #fffbeb; border: 1px dashed #f59e0b;"><h3>๐ ุฏููู ุงูุงุณุชุฎุฏุงู</h3></div>
        </div>
        <div style="text-align:center; color:#94a3b8; font-size:12px; margin-top:20px;">ุฅุนุฏุงุฏ : ุฃ ูุงููู ูุงูุฑ</div>
    </div>
    <div id="guidePage" class="page">
        <button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button>
        <div class="table-container">
            <h2 style="text-align: center; color: var(--accent);">๐ ููุงุญุธุงุช ูุงูุฉ ูุฏููู ุงูุงุณุชุฎุฏุงู</h2>
            <div class="info-box" style="border-right-color: var(--danger); background: #fff1f2;">
                <ul>
                    <li>๐ฉ ูุง ูููู ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุญุณุงุจ ูู ุงุณู ุงููุณุชุฎุฏู ุงู ูููุฉ ุงููุฑูุฑ ุญุงู ูุณูุงูููุ ููุฌุจ ุงู ุชุชุฃูุฏ ูุจู ุฃู ุดูุก ุจุนุฏ ุชุณุฌูู ุญุณุงุจู ูุงูุฏุฎููุ ูุจู ุงู ุชุถูู ุจูุงูุงุชุ ุงุถุบุท ุฎุฑูุฌ ูุฌุฑุจ ุงุฏุฎุงู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ ูุฑุฉ ุงุฎุฑู ูุชุชุฃูุฏ ูู ูุนุฑูุชู ููู.</li>
                    <li>๐ ููุฌุฏ ุญุณุงุจุงุช ุซุงุจุชุฉ ูู ุฏููู ุงูุญุณุงุจุงุช ูุฑุชุจุทุฉ ุจุงูููุงุฆู ุงููุงููุฉ ูุงูุชูุงุฑูุฑุ ูุง ุชุญุงูู ุชุบููุฑ ููุนูุง.</li>
                    <li>๐ ูู ุฎุงูู ุฅุฌุฑุงุก ุนูููุง ููููู ุญุฐู ูุง ุชุฑูุฏ ุนุฏุง ุงูููููู ูู ุงููุตุฏุฑ.</li>
                    <li>๐ ุงุถู ุงูุญุณุงุจุงุช ุฅูู ุฏููู ุงูุญุณุงุจุงุช ุนู ุทุฑูู ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ูุฅุฏุฎุงู ุงุณูู ูููุนู (ุฅุฏุฎุงู ุงูููุน ุจุทุฑููุฉ ุตุญูุญุฉ ูุคุซุฑ ุนูู ุนุฑุถ ุงูููุงุฆู ูุงูุชูุงุฑูุฑ).</li>
                    <li>๐ฆ ููููู ุฅุถุงูุฉ ููุชุฌ ุฃู ุตูู ูู ุงููุฎุฒู ุนู ุทุฑูู ุงูููุฑ ุนูู ุตูู ุฌุฏูุฏ ููุชุงุจุฉ ุงุณูู ูุณุนุฑู.</li>
                    <li>๐ ุชูุชุจ ุฑุตูุฏ ุฃูู ุงููุฏุฉ ูู ุญุงูุฉ ูุง ููุฌุฏ ููุฏ ุงูุชุชุงุญูุ ููู ุญุงูุฉ ูุฌูุฏู ุชุชุฑู ูุงุฑุบุฉุ ููุญุจุฐ ุนูู ููุฏ ุงูุชุชุงุญู ููุตูู.</li>
                    <li>๐ค ููููู ุฅุถุงูุฉ ุจูุงูุงุช ูุชุนุงูู ุนู ุทุฑูู ุงูููุฑ ุนูููุง ูู ุงููุชุนุงูููู ูุชูุชุจ ุงุณูู ูุฑูู ุงููุงุชู ูููุงุญุธุงุช ุฅู ูุฌุฏ.</li>
                    <li>๐ ููููู ุฅูุดุงุก ููุฏ ููููุฉ ุนู ุทุฑูู ุงูุถุบุท ุนูู ููุฏ ุฌุฏูุฏ ูุงุฏุฎุงู ุงูุชุงุฑูุฎ ูุงุฎุชูุงุฑ ุงูุญุณุงุจ ุงููุฏูู ูุงูุฏุงุฆู (ููุตุญ ุจุชุณุฌููู ูู ุฏููู ุงูุญุณุงุจุงุช ุฃููุงุ ููู ูุธูุฑ ูู ูู ูุงุฆูุฉ ููุณุฏูุฉ ููุณูู ุนููู ุงูุฅุฏุฎุงู).</li>
                    <li>๐ค ุฎุงูุฉ ุงูุงุณู ููุชุจ ูููุง ุงุณู ุงูููุชุนุงูู ูุนู (ููุตุญ ุจุชุณุฌููู ูู ุงููุชุนุงูููู ุฃููุงุ ููู ูุธูุฑ ูู ูู ูุงุฆูุฉ ููุณุฏูุฉ ููุณูู ุนููู ุงูุฅุฏุฎุงู).</li>
                    <li>๐ ููููู ุงุฎุชูุงุฑ ุงูุตูู ุงู ุงูููุชุฌ ุนู ุทุฑูู ุงุฎุชูุงุฑู ููุง ุชู ุชุณุฌููู ูู ุงููุฎุฒู.</li>
                    <li>โ๏ธ ููุฒุงู ุงููุฑุงุฌุนุฉ ููุงุฆูุฉ ุงูุฏุฎู ูุงููุฑูุฒ ุงููุงูู ุขููููุ ููุนุฑุถ ููุท ูููุฑุญู ุฅูููู ุงูููุงุณุจ ุชููุงุฆูุงู.</li>
                    <li>๐ ูุณูุญ ุจุงูููุฏ ูู ุญุณุงุจ ูุงุญุฏ ูุญุณุงุจ ูุงุญุฏุ ูุฅุฐุงูุงู ุจุงูููุฏ ูุฐููุฑููุ ูุชู ุชูุณูู ุงูููุฏ ูู ุงูุฅุฏุฎุงู.</li>
                    <li>๐ ููุถู ุฅุฏุฎุงู ุงูุฃุฑุตุฏุฉ ุงูุงูุชุชุงุญูุฉ.</li>
                    <li>๐ ูููุฉ ุงูุตูู ูู ุงููุฎุฒู ุชุชุฃุซุฑ ุจุฑุตูุฏ ุฃูู ุงููุชุฑุฉ ูุญุณุงุจ ุงููุฎุฒูู ุฅุฐุง ูุงู ูุฏูู ุฃู ุฏุงุฆู.</li>
                    <li>๐ ูููุฏ ุงูููููุฉ ุชุนูู ุจูุธุงู ุงูุฌุฑุฏ ุงููุณุชูุฑุ ููู ุงูุจูุน ูุงูุดุฑุงุก ูุชู ุงุณุชุนูุงู ุญุณุงุจ ุงููุจูุนุงุช ูุชูููุฉ ุงูุจุถุงุนุฉ ูุงููุฎุฒูู ุจุดูู ุฑุฆูุณู.</li>
                    <li>๐ณ ูุฏููููุฉ ุฃู ุฏุงุฆููุฉ ุงููุชุนุงูู ุชูุญุฏุฏ ุจุญุณุงุจ ุงููุฏูููู ูุงูุนููุงุก ูู ุฏูุชุฑ ุงูููููุฉุ ูุฃูุถุงู ุญุณุงุจ ุงูุนููุงุก ูุงูููุฑุฏูู (ููุท).</li>
                    <li>๐ซ ูู ุงูููุงุฆู ุงููุงููุฉ ูุชู ุชุฌุงูู ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช ุงููุฏููุฉ ุงูุชู ููุง ุฑุตูุฏ ููุงุฆู ุฏุงุฆู ููุฐูู ุงูุญุณุงุจุงุช ุงูุฏุงุฆูุฉ ุงูุชู ููุง ุฑุตูุฏ ููุงุฆู ูุฏูู.</li>
                    <li>โ ููููู ุฅุฏุฎุงู ูููุฏ ุงูุฌุฑุฏ ูุงูุฅููุงู ุจุณูุงุณุฉ.</li>
                    <li>๐พ ุจุนุฏ ุงูุงูุชูุงุก ูู ุฅุฏุฎุงู ุจูุงูุงุชู ุงุถุบุท ุญูุธ ุงูุจูุงูุงุช ููู ุชุฌุฏูุง ุนูุฏ ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู.</li>
                </ul>
            </div>
            <div style="text-align: center; padding: 20px; font-size: 12px; color: #64748b; border-top: 1px solid #e2e8f0; line-height: 1.6;">
                <p>โ"ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ 2026 ููุฃุณุชุงุฐ ูุงููู ูุงูุฑ ูุฎุฑู ูููุง. ููููุน ููุนุงู ุจุงุชุงู ุฅุนุงุฏุฉ ููุฏุณุฉ ุงูููุฏ ุงูุจุฑูุฌู ุฃู ุงุณุชุฎุฏุงูู ูุฃุบุฑุงุถ ุชุฌุงุฑูุฉ ุฏูู ุฅุฐู ูุชุงุจู ูุณุจู. ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ุจุญุฑุต ูุถูุงู ุงุณุชูุฑุงุฑ ุงูุฃุฏุงุกุ ููุจุฐู ุงููุจุฑูุฌ ุฃูุตู ุฌูุฏ ูุชุฃููู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุชูููุงุช ุชุดููุฑ ูุชุทูุฑุฉุ ููุน ุฐููุ ูุง ูุชุญูู ุงููุจุฑูุฌ ุงููุณุคูููุฉ ุนู ุฃู ููุฏุงู ุฃู ุณุฑูุฉ ุจูุงูุงุช ูุงุชุฌุฉ ุนู ุฅููุงู ุงููุณุชุฎุฏู ูู ุงูุญูุงุธ ุนูู ูููุฉ ุงููุฑูุฑุ ุฃู ุงุณุชุฎุฏุงู ุฃุฌูุฒุฉ ุบูุฑ ูุญููุฉ ุฃู ูุชุตูุญุงุช ุบูุฑ ูุญุฏุซุฉุ ุฃู ุจุณุจุจ ูุฌูุงุช ุฅููุชุฑูููุฉ ุฎุงุฑุฌุฉ ุนู ุญุฏูุฏ ุงูุญูุงูุฉ ุงูุจุฑูุฌูุฉ ุงููุชุจุนุฉ."
โv1.0.2 | Secured by Firebase Auth | Copyright 2026</p>
                <b>v1.0.2 | Secured by Firebase Auth | Copyright 2026</b>
            </div>
        </div>
    </div>
    <div id="accountsPage" class="page"><button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button><div class="table-container"><h3>ุฏููู ุงูุญุณุงุจุงุช</h3><button class="btn btn-add" onclick="addAcc()">+ ุญุณุงุจ ุฌุฏูุฏ</button><table><thead><tr><th>ุงุณู ุงูุญุณุงุจ</th><th>ุงูููุน</th><th>ุฅุฌุฑุงุก</th></tr></thead><tbody id="accountsBody"></tbody></table></div></div>
    <div id="journalPage" class="page"><button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button><div class="table-container"><button class="btn btn-add" onclick="addJ()">+ ููุฏ ุฌุฏูุฏ</button><table><thead><tr><th>ุงูุชุงุฑูุฎ</th><th>ูุฏูู</th><th>ุฏุงุฆู</th><th>ุงูุงุณู</th><th>ุงูุตูู</th><th>ุงููููุฉ</th><th>ุงููุจูุบ</th><th>ุฅุฌุฑุงุก</th></tr></thead><tbody id="journalBody"></tbody></table></div></div>
    <div id="productsPage" class="page"><button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button><div class="table-container"><button class="btn btn-add" onclick="addP()">+ ุตูู ุฌุฏูุฏ</button><table><thead><tr><th>ุงูุตูู</th><th>ุงูุณุนุฑ</th><th>ุฑุตูุฏ ุฃูู</th><th>ุงูุฑุตูุฏ ุงูุญุงูู</th><th>ุฅุฌุฑุงุก</th></tr></thead><tbody id="productsBody"></tbody></table></div></div>
    <div id="partnersPage" class="page"><button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button><div class="table-container"><h3>ุฏููู ุงููุชุนุงูููู ูุงูุฏููู</h3><button class="btn btn-add" onclick="addPartnerInfo()">+ ุฅุถุงูุฉ ุจูุงูุงุช ูุชุนุงูู</button><table><thead><tr><th>ุงูุงุณู</th><th>ุงููุงุชู</th><th>ููุงุญุธุงุช</th><th>ูุฏูู (+)</th><th>ุฏุงุฆู (-)</th><th>ุงูุตุงูู</th><th>ุฅุฌุฑุงุก</th></tr></thead><tbody id="partnersBody"></tbody></table></div></div>
    <div id="trialPage" class="page"><button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button><div class="table-container"><table><thead><tr><th>ุงูุญุณุงุจ</th><th>ูุฏูู</th><th>ุฏุงุฆู</th><th>ุฑุตูุฏ ู</th><th>ุฑุตูุฏ ุฏ</th></tr></thead><tbody id="trialBody"></tbody></table></div></div>
    <div id="incomePage" class="page"><button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button><div class="table-container"><h2 style="text-align: center;">๐ ูุงุฆูุฉ ุงูุฏุฎู</h2><table><tbody id="incomeBody"></tbody></table></div></div>
    <div id="balanceSheetPage" class="page"><button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button><div class="report-grid"><div class="table-container"><h3>ุงูุฃุตูู</h3><table><thead><tr><th>ุงูุญุณุงุจ</th><th>ุงููุจูุบ</th></tr></thead><tbody id="assetsBody"></tbody></table></div><div class="table-container"><h3>ุงูุงูุชุฒุงูุงุช ูุญููู ุงูููููุฉ</h3><table><thead><tr><th>ุงูุญุณุงุจ</th><th>ุงููุจูุบ</th></tr></thead><tbody id="liabilitiesBody"></tbody></table></div></div></div>
</div>
<datalist id="accList"></datalist>
<datalist id="partnerList"></datalist>

<script type="module">
    // 1. ุญูุงูุฉ ุงูุฑุงุจุท ุงูุตุงุฑู
    const _0xTarget = atob('bWljaGFlbG1haGVyOTIzLWN5YmVyLmdpdGh1Yi5pbw==');
    if (window.location.hostname !== _0xTarget) {
        document.body.innerHTML = '<div style="direction:rtl;text-align:center;padding:50px;font-family:sans-serif;"><h2>โ๏ธ ูุณุฎุฉ ุบูุฑ ูุฑุฎุตุฉ</h2><p>ูุฐุง ุงููุธุงู ูุนูู ููุท ุนูู ุงูุฑุงุจุท ุงูุฑุณูู ููุฃุณุชุงุฐ ูุงููู ูุงูุฑ.</p></div>';
        window.stop();
    }

    // 2. ุงุณุชูุฑุงุฏ ุงูููุชุจุงุช
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const config = {
        apiKey: "AIzaSyBP7HP1w4MbOFZWnv7BdpKwDlYjv4VJUTM",
        authDomain: "accountsite26.firebaseapp.com",
        databaseURL: "https://accountsite26-default-rtdb.firebaseio.com",
        projectId: "accountsite26",
        storageBucket: "accountsite26.firebasestorage.app",
        messagingSenderId: "1015795938039",
        appId: "1:1015795938039:web:b625e24fca2c5b231d19f2"
    };

    const app = initializeApp(config);
    const db = getDatabase(app);
    const auth = getAuth(app);

    // 3. ุฏุงูุฉ ุงูุชุจุฏูู (ูุฐุง ูุง ูุงู ูููุตู)
    window.switchAuth = (isLogin) => {
        document.getElementById('loginTab').classList.toggle('active', isLogin);
        document.getElementById('registerTab').classList.toggle('active', !isLogin);
        document.querySelector('.auth-box .btn-save').innerText = isLogin ? 'ุฏุฎูู' : 'ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ';
    };

    // 4. ูุนุงูุฌุฉ ุงูุฏุฎูู ูุงูุชุณุฌูู
    window.processAuth = async () => {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value.trim();
        const isLogin = document.getElementById('loginTab').classList.contains('active');
        
        if(!u || !p) return alert("โ๏ธ ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ");
        if(p.length < 6) return alert("โ๏ธ ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ุชููู 6 ุฎุงูุงุช ุนูู ุงูุฃูู");

        // ุญูุธ ุงูุงุณู ุจุงูุนุฑุจู ูู ุฐุงูุฑุฉ ุงููุชุตูุญ
        localStorage.setItem('user_display_name', u); 

        document.getElementById('loader').style.display = 'flex';
        const safeUser = btoa(unescape(encodeURIComponent(u))).replace(/[/+=]/g, "").toLowerCase().substring(0, 15);
        const email = safeUser + "@maher-system.com";

        try {
            if (isLogin) { await signInWithEmailAndPassword(auth, email, p); } 
            else { await createUserWithEmailAndPassword(auth, email, p); alert("โ ุชู ุงูุชุณุฌูู ุจูุฌุงุญ"); }
        } catch (e) {
            alert("ุญุฏุซ ุฎุทุฃ ูู ุงูุจูุงูุงุช ุฃู ุงููุณุชุฎุฏู ููุฌูุฏ ุจุงููุนู");
            document.getElementById('loader').style.display = 'none';
        }
    };

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            // ูุฑุงุกุฉ ุงูุงุณู ุงูุนุฑุจู ุงููุฎุฒู
            const savedName = localStorage.getItem('user_display_name');
            window.currentUser = savedName || user.email.split('@')[0];
            
            const snapshot = await get(ref(db, `users/${user.uid}/data`));
            const data = snapshot.exists() ? snapshot.val() : {};
            window.userDB = { accounts: data.accounts || [], journal: data.journal || [], products: data.products || [], partnersInfo: data.partnersInfo || [] };
            initFixedAccounts(); 
            startApp();
        }
    });

    window.syncToCloud = async () => {
        if(!auth.currentUser) return;
        document.getElementById('loader').style.display = 'flex';
        try { await set(ref(db, `users/${auth.currentUser.uid}/data`), window.userDB); alert("โ ุชู ุงูุญูุธ ุจูุฌุงุญ"); } 
        catch (e) { alert("โ ูุดู ุงูุญูุธ"); }
        document.getElementById('loader').style.display = 'none';
    };

    window.logout = () => { signOut(auth).then(() => location.reload()); };
</script>

<script>
    // [Application Logic Obfuscation]
    (function(_0xX1){
        const _0xK2 = ["ุงููุฎุฒูู", "ุงูุนููุงุก", "ุงูููุฑุฏูู", "ุงููุฏูููู", "ุงูุฏุงุฆููู"];
        const _0xK3 = ["ุฃุตูู", "ุงูุชุฒุงูุงุช", "ุญููู ููููุฉ", "ูุจูุนุงุช", "ุชูููุฉ ูุจูุนุงุช", "ูุตุฑููุงุช", "ุฅูุฑุงุฏุงุช", "ุฅูุฑุงุฏุงุช ุฃุฎุฑู", "ูุตุฑููุงุช ุงุฎุฑู", "ุบูุฑ ุฐูู"];

        window.initFixedAccounts = function() {
            if(!userDB.accounts) userDB.accounts = [];
            _0xK2.forEach(n => {
                if(!userDB.accounts.find(a => a.name === n)) {
                    let t = (n === "ุงูููุฑุฏูู" || n === "ุงูุฏุงุฆููู") ? 'ุงูุชุฒุงูุงุช' : 'ุฃุตูู';
                    userDB.accounts.push({name: n, type: t, fixed: true});
                }
            });
        };

        window.startApp = function() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'block';
            document.getElementById('loader').style.display = 'none';
            document.getElementById('userDisplay').innerText = "๐ค " + currentUser;
            updateDatalists(); openPage('homePage');
        };

        window.openPage = function(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            render(id);
        };

        window.updateDatalists = function() {
            const dl = document.getElementById('accList'); dl.innerHTML = '';
            userDB.accounts.forEach(a => { if(a.name) dl.innerHTML += `<option value="${a.name}">`; });
            const pl = document.getElementById('partnerList'); pl.innerHTML = '';
            userDB.partnersInfo.forEach(p => { if(p.name) pl.innerHTML += `<option value="${p.name}">`; });
        };

        window.getTrialBalances = function() {
            let accs = {};
            userDB.accounts.forEach(a => { if(a.name) accs[a.name] = { d: 0, c: 0, type: a.type }; });
            userDB.journal.forEach(j => {
                if(accs[j.deb]) accs[j.deb].d += parseFloat(j.v) || 0;
                if(accs[j.cre]) accs[j.cre].c += parseFloat(j.v) || 0;
            });
            let res = [];
            for(let n in accs) {
                let bal = accs[n].d - accs[n].c;
                res.push({ name: n, type: accs[n].type, balance: bal, d: accs[n].d, c: accs[n].c });
            }
            return res;
        };

        window.calculateNetProfit = function() {
            let b = getTrialBalances();
            let s = (t) => b.filter(a => a.type === t).reduce((x, a) => x + Math.abs(a.balance), 0);
            return (s('ูุจูุนุงุช') - s('ุชูููุฉ ูุจูุนุงุช')) + (s('ุฅูุฑุงุฏุงุช ุฃุฎุฑู') + s('ุฅูุฑุงุฏุงุช')) - (s('ูุตุฑููุงุช ุงุฎุฑู') + s('ูุตุฑููุงุช'));
        };

        window.render = function(id) {
            if(id === 'accountsPage') {
                const b = document.getElementById('accountsBody'); b.innerHTML = '';
                userDB.accounts.forEach((a, i) => {
                    let o = _0xK3.map(t => `<option ${a.type==t?'selected':''}>${t}</option>`).join('');
                    b.innerHTML += `<tr><td><input value="${a.name}" ${a.fixed?'readonly':''} onchange="userDB.accounts[${i}].name=this.value;updateDatalists()"></td><td><select onchange="userDB.accounts[${i}].type=this.value">${o}</select></td><td>${a.fixed ? '๐' : `<button class="btn btn-del" onclick="userDB.accounts.splice(${i},1);render('accountsPage')">๐๏ธ</button>`}</td></tr>`;
                });
            }
            if(id === 'journalPage') {
                const b = document.getElementById('journalBody'); b.innerHTML = '';
                userDB.journal.forEach((j, i) => {
                    let pO = `<option value="">-- ุตูู --</option>` + userDB.products.map(p => `<option value="${p.name}" ${j.prod===p.name?'selected':''}>${p.name}</option>`).join('');
                    b.innerHTML += `<tr><td><input type="date" value="${j.date||''}" onchange="userDB.journal[${i}].date=this.value"></td><td><input list="accList" value="${j.deb||''}" onchange="userDB.journal[${i}].deb=this.value"></td><td><input list="accList" value="${j.cre||''}" onchange="userDB.journal[${i}].cre=this.value"></td><td><input list="partnerList" value="${j.name||''}" onchange="userDB.journal[${i}].name=this.value"></td><td><select onchange="updateRowPrice(${i}, this.value)">${pO}</select></td><td><input type="number" id="q${i}" value="${j.q||0}" oninput="validateStock(${i})"></td><td><input type="number" id="v${i}" value="${j.v||0}" oninput="userDB.journal[${i}].v=this.value"></td><td><button class="btn btn-save" onclick="render('journalPage')">๐พ</button> <button class="btn btn-del" onclick="userDB.journal.splice(${i},1);render('journalPage')">๐๏ธ</button></td></tr>`;
                });
            }
            if(id === 'partnersPage') {
                const b = document.getElementById('partnersBody'); b.innerHTML = '';
                let pC = {};
                userDB.journal.forEach(j => {
                    if(j.name) {
                        let n = j.name.trim(); if(!pC[n]) pC[n] = { d: 0, c: 0 };
                        let v = parseFloat(j.v) || 0;
                        if(["ุงูุนููุงุก", "ุงููุฏูููู", "ุงูููุฑุฏูู", "ุงูุฏุงุฆููู"].includes(j.deb)) pC[n].d += v;
                        if(["ุงูุนููุงุก", "ุงููุฏูููู", "ุงูููุฑุฏูู", "ุงูุฏุงุฆููู"].includes(j.cre)) pC[n].c += v;
                    }
                });
                userDB.partnersInfo.forEach((p, i) => {
                    let d = pC[p.name] ? pC[p.name].d : 0, c = pC[p.name] ? pC[p.name].c : 0, net = d - c;
                    b.innerHTML += `<tr><td><input value="${p.name}" onchange="userDB.partnersInfo[${i}].name=this.value;updateDatalists()"></td><td><input value="${p.phone||''}" onchange="userDB.partnersInfo[${i}].phone=this.value"></td><td><input value="${p.note||''}" onchange="userDB.partnersInfo[${i}].note=this.value"></td><td style="color:blue">${d}</td><td style="color:orange">${c}</td><td style="font-weight:bold; color:${net>=0?'green':'red'}">${net}</td><td><button class="btn btn-del" onclick="userDB.partnersInfo.splice(${i},1);render('partnersPage')">๐๏ธ</button></td></tr>`;
                });
            }
            if(id === 'trialPage') {
                const b = document.getElementById('trialBody'); b.innerHTML = '';
                getTrialBalances().forEach(a => { b.innerHTML += `<tr><td>${a.name}</td><td>${a.d}</td><td>${a.c}</td><td>${a.balance>0?a.balance:0}</td><td>${a.balance<0?Math.abs(a.balance):0}</td></tr>`; });
            }
            if(id === 'incomePage') {
                const b = document.getElementById('incomeBody'); b.innerHTML = '';
                let bl = getTrialBalances();
                let sm = (t) => bl.filter(a => a.type === t).reduce((s, a) => s + Math.abs(a.balance), 0);
                let m = sm('ูุจูุนุงุช'), c = sm('ุชูููุฉ ูุจูุนุงุช'), r = m - c, oR = sm('ุฅูุฑุงุฏุงุช ุฃุฎุฑู') + sm('ุฅูุฑุงุฏุงุช'), oE = sm('ูุตุฑููุงุช ุงุฎุฑู') + sm('ูุตุฑููุงุช'), n = r + oR - oE;
                b.innerHTML = `<tr><td>ุฅุฌูุงูู ุงููุจูุนุงุช</td><td>${m}</td></tr><tr><td>(-) ุชูููุฉ ุงูุจุถุงุนุฉ</td><td>${c}</td></tr><tr class="total-row"><td>ูุฌูู ุงูุฑุจุญ</td><td>${r}</td></tr><tr><td>(+) ุฅูุฑุงุฏุงุช ุฃุฎุฑู</td><td>${oR}</td></tr><tr><td>(-) ูุตุฑููุงุช</td><td>${oE}</td></tr><tr class="total-row" style="background:#dcfce7"><td>ุตุงูู ุงูุฑุจุญ</td><td>${n}</td></tr>`;
            }
            if(id === 'balanceSheetPage') {
                let bl = getTrialBalances(), ab = document.getElementById('assetsBody'), lb = document.getElementById('liabilitiesBody');
                ab.innerHTML = ''; lb.innerHTML = ''; let tA = 0, tL = 0;
                bl.forEach(a => {
                    if(a.type === 'ุฃุตูู' && a.balance > 0) { let v = a.balance; tA += v; ab.innerHTML += `<tr><td>${a.name}</td><td>${v}</td></tr>`; }
                    if(['ุงูุชุฒุงูุงุช', 'ุญููู ููููุฉ'].includes(a.type) && a.balance < 0) { let v = Math.abs(a.balance); tL += v; lb.innerHTML += `<tr><td>${a.name}</td><td>${v}</td></tr>`; }
                });
                let nt = calculateNetProfit(); tL += nt;
                lb.innerHTML += `<tr style="background:#f0fdf4; font-weight:bold; color:var(--success)"><td>ุตุงูู ุงูุฑุจุญ</td><td>${nt}</td></tr><tr class="total-row"><td>ุงูุฅุฌูุงูู</td><td>${tA}</td></tr>`;
                ab.innerHTML += `<tr class="total-row"><td>ุงูุฅุฌูุงูู</td><td>${tA}</td></tr>`;
                document.querySelector('#liabilitiesBody tr:last-child td:last-child').innerText = tL;
            }
            if(id === 'productsPage') {
                const b = document.getElementById('productsBody'); b.innerHTML = '';
                userDB.products.forEach((p, i) => {
                    let cr = parseFloat(p.op)||0;
                    userDB.journal.forEach(j => { if(j.prod===p.name){ if(j.deb==="ุงููุฎุฒูู")cr+=parseFloat(j.q); if(j.cre==="ุงููุฎุฒูู")cr-=parseFloat(j.q); }});
                    b.innerHTML += `<tr><td><input value="${p.name||''}" onchange="userDB.products[${i}].name=this.value"></td><td><input type="number" value="${p.price||0}" onchange="userDB.products[${i}].price=this.value"></td><td><input type="number" value="${p.op||0}" onchange="userDB.products[${i}].op=this.value"></td><td>${cr}</td><td><button class="btn btn-del" onclick="userDB.products.splice(${i},1);render('productsPage')">๐๏ธ</button></td></tr>`;
                });
            }
        };

        window.validateStock = function(i) {
            let j = userDB.journal[i];
            if(j.cre === "ุงููุฎุฒูู" && j.prod) {
                let pr = userDB.products.find(p => p.name === j.prod), cur = parseFloat(pr.op)||0;
                userDB.journal.forEach((jj, idx) => { if(idx !== i && jj.prod === j.prod) { if(jj.deb === "ุงููุฎุฒูู") cur += parseFloat(jj.q)||0; if(jj.cre === "ุงููุฎุฒูู") cur -= parseFloat(jj.q)||0; }});
                if(parseFloat(document.getElementById('q'+i).value) > cur) { alert("ุงููุชุงุญ: " + cur); document.getElementById('q'+i).value = 0; }
            }
            calcRowVal(i);
        };

        window.updateRowPrice = function(i, n) {
            const p = userDB.products.find(x => x.name === n);
            userDB.journal[i].prod = n;
            if(p) { document.getElementById('v'+i).value = (parseFloat(p.price) || 0) * (parseFloat(document.getElementById('q'+i).value) || 0); userDB.journal[i].v = document.getElementById('v'+i).value; }
        };

        window.calcRowVal = function(i) {
            userDB.journal[i].q = document.getElementById('q'+i).value;
            const p = userDB.products.find(x => x.name === userDB.journal[i].prod);
            if(p) { document.getElementById('v'+i).value = (parseFloat(p.price) || 0) * (parseFloat(userDB.journal[i].q) || 0); userDB.journal[i].v = document.getElementById('v'+i).value; }
        };

        window.addAcc = () => { userDB.accounts.push({name:'', type:'ุฃุตูู', fixed: false}); render('accountsPage'); };
        window.addJ = () => { userDB.journal.push({date: new Date().toISOString().split('T')[0], q:0, v:0, deb:'', cre:'', name:'', prod:''}); render('journalPage'); };
        window.addP = () => { userDB.products.push({name:'', price:0, op:0}); render('productsPage'); };
        window.addPartnerInfo = () => { userDB.partnersInfo.push({name:'', phone:'', note:''}); render('partnersPage'); };
    })();
</script>
</body>
</html>