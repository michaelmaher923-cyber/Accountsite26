<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุงููุญุงุณุจ</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        :root { --main: #1e293b; --accent: #0284c7; --bg: #f8fafc; --white: #ffffff; --danger: #be123c; --success: #059669; --blue-row: #d1e9ff; --green-row: #d1fadc; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; color: #334155; }
        header { background: var(--main); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo-img { width: 40px; height: 40px; background: var(--accent); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .page { display: none; padding: 25px; }
        .page.active { display: block; }
        .table-container { background: var(--white); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f1f5f9; padding: 12px; border: 1px solid #e2e8f0; font-size: 13px; color: var(--main); }
        td { padding: 8px; border: 1px solid #e2e8f0; text-align: center; }
        input, select { width: 92%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 14px; }
        input[readonly] { background-color: #f1f5f9; color: #64748b; cursor: not-allowed; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-save { background: var(--success); color: white; }
        .btn-del { background: var(--danger); color: white; }
        .btn-ins { background: var(--success); color: white; padding: 5px 10px; font-size: 12px; margin-left: 2px; }
        .btn-add { background: var(--main); color: white; margin-bottom: 15px; }
        .btn-excel { background: #166534; color: white; margin-right: 5px; }
        .btn-import { background: #ea580c; color: white; margin-right: 5px; }
        .search-container { margin-bottom: 15px; display: flex; gap: 10px; align-items: center; }
        .search-input { width: 300px; padding: 8px; border: 2px solid var(--accent); border-radius: 6px; }
        .highlight { background-color: #fef08a !important; transition: 0.3s; }
        .row-blue { background-color: var(--blue-row) !important; }
.row-green { background-color: var(--green-row) !important; }
        .nav-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; text-align: center; cursor: pointer; border: 1px solid #e2e8f0; transition: 0.3s; }
        .card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .auth-box { max-width: 400px; margin: 80px auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); text-align: center; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #f1f5f9; }
        .tab { flex: 1; padding: 10px; cursor: pointer; font-weight: bold; color: #94a3b8; }
        .tab.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        #loader { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:9999; justify-content:center; align-items:center; flex-direction:column; }
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .total-row { background: #f8fafc; font-weight: bold; }
    </style>
</head>
<body>
<div id="loader"><b>โณ ุฌุงุฑู ุงูุงุชุตุงู...</b></div>
<div id="authScreen" class="auth-box">
    <div class="logo-img" style="margin: 0 auto 20px; width: 60px; height: 60px; font-size: 30px;">๐</div>
    <div class="tabs">
        <div id="loginTab" class="tab active" onclick="switchAuth(true)">ุชุณุฌูู ุงูุฏุฎูู</div>
        <div id="registerTab" class="tab" onclick="switchAuth(false)">ุฅูุดุงุก ุญุณุงุจ</div>
    </div>
    <input type="text" id="username" placeholder="ุงุณู ุงููุณุชุฎุฏู" style="margin-bottom:15px; width:100%;">
    <input type="password" id="password" placeholder="ูููุฉ ุงููุฑูุฑ" style="margin-bottom:15px; width:100%;">
<input type="text" id="activationCode" placeholder="ููุฏ ุงูุชุญูู (ุงูููุชุงุญ)" style="margin-bottom:5px; width:100%; border: 2px solid var(--accent);">
    <p style="font-size: 11px; color: var(--danger); margin-bottom: 10px;">* ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ูุง ุชูู ุนู 6 ุฃุญุฑู ุฃู ุฃุฑูุงู</p>
    <button class="btn btn-save" style="width:100%" onclick="processAuth()">ุฏุฎูู</button>
</div>
<div id="appScreen" style="display:none;">
    <header>
        <div style="display:flex; align-items:center; gap:12px;"><div class="logo-img">๐</div><h2 style="margin:0">ุงููุญุงุณุจ</h2></div>
        <div style="display:flex; align-items:center; gap:15px;">
            <span id="userDisplay" style="font-weight: bold;"></span>
            <button class="btn btn-save" onclick="syncToCloud()" style="background:var(--success)">ุญูุธ ุงูุจูุงูุงุช</button>
            <button class="btn btn-del" onclick="logout()">ุฎุฑูุฌ</button>
        </div>
    </header>
    
    <div id="homePage" class="page active">
        <div class="nav-menu">
            <div class="card" onclick="openPage('accountsPage')"><h3>๐ ุงูุญุณุงุจุงุช</h3></div>
            <div class="card" onclick="openPage('journalPage')"><h3>๐ ุงูููููุฉ</h3></div>
            <div class="card" onclick="openPage('productsPage')"><h3>๐ฆ ุงููุฎุฒู</h3></div>
            <div class="card" onclick="openPage('partnersPage')"><h3>๐ค ุงููุชุนุงูููู</h3></div>
            <div class="card" onclick="openPage('trialPage')"><h3>โ๏ธ ุงูููุฒุงู</h3></div>
            <div class="card" onclick="openPage('incomePage')" style="background: #f0fdf4;"><h3>๐ ูุงุฆูุฉ ุงูุฏุฎู</h3></div>
            <div class="card" onclick="openPage('balanceSheetPage')" style="background: #eff6ff;"><h3>๐ฆ ุงููุฑูุฒ ุงููุงูู</h3></div>
            <div class="card" onclick="openPage('guidePage')" style="background: #fffbeb; border: 1px dashed #f59e0b;"><h3>๐ ุฏููู ุงูุงุณุชุฎุฏุงู</h3></div>
        </div>
        <div style="text-align:center; color:#94a3b8; font-size:12px; margin-top:20px;">ุฅุนุฏุงุฏ : ุฃ ูุงููู ูุงูุฑ</div>
    </div>

    <div id="accountsPage" class="page">
        <button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="ุจุญุซ ูู ุงูุญุณุงุจุงุช..." oninput="tableSearch('accountsBody', this.value)">
            <button class="btn btn-excel" onclick="exportData('accounts')">ุชุตุฏูุฑ Excel</button>
            <button class="btn btn-import" onclick="document.getElementById('fileAcc').click()">ุงุณุชูุฑุงุฏ Excel</button>
            <input type="file" id="fileAcc" hidden onchange="importData(this, 'accounts')" accept=".xlsx, .xls">
        </div>
        <div class="table-container"><h3>ุฏููู ุงูุญุณุงุจุงุช</h3><button class="btn btn-add" onclick="addAcc()">+ ุญุณุงุจ ุฌุฏูุฏ</button><table><thead><tr><th>ุงุณู ุงูุญุณุงุจ</th><th>ุงูููุน</th><th>ุฅุฌุฑุงุก</th></tr></thead><tbody id="accountsBody"></tbody></table></div>
    </div>

    <div id="journalPage" class="page">
        <button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="ุจุญุซ ูู ุงูููููุฉ..." oninput="tableSearch('journalBody', this.value)">
            <button class="btn btn-excel" onclick="exportData('journal')">ุชุตุฏูุฑ Excel</button>
            <button class="btn btn-import" onclick="document.getElementById('fileJou').click()">ุงุณุชูุฑุงุฏ Excel</button>
            <input type="file" id="fileJou" hidden onchange="importData(this, 'journal')" accept=".xlsx, .xls">
        </div>
        <div class="table-container">
    <button class="btn btn-add" onclick="addJ()">+ ููุฏ ุฌุฏูุฏ</button>
    <table>
        <thead>
            <tr>
                <th style="width: 60px;">ุฑูู ุงูููุฏ</th>
                <th>ุงูุชุงุฑูุฎ</th>
                <th>ูุฏูู</th>
                <th>ุฏุงุฆู</th>
                <th>ุงูุงุณู</th>
                <th>ุงููุจูุบ</th>
                <th>ููุงุญุธุงุช</th>
                <th>ุฅุฌุฑุงุก</th>
            </tr>
        </thead>
        <tbody id="journalBody"></tbody>
    </table>
</div>
    </div>

    <div id="productsPage" class="page">
        <button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="ุจุญุซ ูู ุงูุฃุตูุงู..." oninput="tableSearch('productsBody', this.value)">
            <button class="btn btn-excel" onclick="exportData('products')">ุชุตุฏูุฑ Excel</button>
            <button class="btn btn-import" onclick="document.getElementById('fileProd').click()">ุงุณุชูุฑุงุฏ Excel</button>
            <input type="file" id="fileProd" hidden onchange="importData(this, 'products')" accept=".xlsx, .xls">
        </div>
        <div class="table-container"><h3>๐ฆ ุฅุฏุงุฑุฉ ุงููุฎุฒู</h3><button class="btn btn-add" onclick="addP()">+ ุตูู ุฌุฏูุฏ</button><table><thead><tr><th>ุงูุตูู</th><th>ุงูุณุนุฑ</th><th>ูุงุฑุฏ</th><th>ููุตุฑู</th><th>ุงูุฑุตูุฏ ุงูุตุงูู</th><th>ุฅุฌุฑุงุก</th></tr></thead><tbody id="productsBody"></tbody></table></div>
    </div>

    <div id="partnersPage" class="page">
        <button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="ุจุญุซ ูู ุงููุชุนุงูููู..." oninput="tableSearch('partnersBody', this.value)">
            <button class="btn btn-excel" onclick="exportData('partners')">ุชุตุฏูุฑ Excel</button>
            <button class="btn btn-import" onclick="document.getElementById('filePart').click()">ุงุณุชูุฑุงุฏ Excel</button>
            <input type="file" id="filePart" hidden onchange="importData(this, 'partners')" accept=".xlsx, .xls">
        </div>
        <div class="table-container"><h3>ุฏููู ุงููุชุนุงูููู ูุงูุฏููู</h3><button class="btn btn-add" onclick="addPartnerInfo()">+ ุฅุถุงูุฉ ุจูุงูุงุช ูุชุนุงูู</button><table><thead><tr><th>ุงูุงุณู</th><th>ุงููุงุชู</th><th>ููุงุญุธุงุช</th><th>ูุฏูู (+)</th><th>ุฏุงุฆู (-)</th><th>ุงูุตุงูู</th><th>ุฅุฌุฑุงุก</th></tr></thead><tbody id="partnersBody"></tbody></table></div>
    </div>

    <div id="statementPage" class="page">
        <button class="btn btn-add" onclick="openPage('partnersPage')">โฌ ุฑุฌูุน</button>
        <button class="btn btn-excel" onclick="window.print()">๐จ๏ธ ุทุจุงุนุฉ ูุดู ุงูุญุณุงุจ</button>
        <div class="table-container" id="printArea">
            <h2 id="stName" style="text-align: center; color: var(--main); margin-bottom:5px;">ูุดู ุญุณุงุจ</h2>
            <p id="stDetails" style="text-align: center; margin-bottom:20px;">ุชูุฑูุฑ ุชูุตููู ุจุงููุนุงููุงุช ุงูุขุฌูุฉ</p>
            <table>
                <thead>
                    <tr>
                        <th style="width:100px">ุงูุชุงุฑูุฎ</th>
                        <th style="width:80px">ุฑูู ุงูููุฏ</th>
                        <th>ุงูุจูุงู (ููุงุญุธุงุช)</th>
                        <th style="width:90px">ูุฏูู (+)</th>
                        <th style="width:90px">ุฏุงุฆู (-)</th>
                        <th style="width:100px">ุงูุฑุตูุฏ ุงูุฌุงุฑู</th>
                    </tr>
                </thead>
                <tbody id="statementBody"></tbody>
            </table>
        </div>
    </div>
    
    <div id="incomePage" class="page">
        <button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button>
        <div class="search-container">
            <button class="btn btn-excel" onclick="exportTableToExcel('incomeBody', 'ูุงุฆูุฉ_ุงูุฏุฎู')">ุชุตุฏูุฑ Excel</button>
        </div>
        <div class="table-container"><h2 style="text-align: center;">๐ ูุงุฆูุฉ ุงูุฏุฎู</h2><table><tbody id="incomeBody"></tbody></table></div>
    </div>

    <div id="balanceSheetPage" class="page">
        <button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button>
        <div class="search-container">
            <button class="btn btn-excel" onclick="exportBalanceSheet()">ุชุตุฏูุฑ Excel</button>
        </div>
        <div class="report-grid"><div class="table-container"><h3>ุงูุฃุตูู</h3><table><thead><tr><th>ุงูุญุณุงุจ</th><th>ุงููุจูุบ</th></tr></thead><tbody id="assetsBody"></tbody></table></div><div class="table-container"><h3>ุงูุงูุชุฒุงูุงุช ูุญููู ุงูููููุฉ</h3><table><thead><tr><th>ุงูุญุณุงุจ</th><th>ุงููุจูุบ</th></tr></thead><tbody id="liabilitiesBody"></tbody></table></div></div>
    </div>

    <div id="guidePage" class="page">
        <button class="btn btn-add" onclick="openPage('homePage')">โฌ ุฑุฌูุน</button>
        
        <div class="table-container" style="text-align: right; line-height: 1.8;">
            <h2 style="color: var(--accent); border-bottom: 2px solid #e2e8f0; padding-bottom: 10px;">๐ ุฏููู ุงูุงุณุชุฎุฏุงู ูุงูุชุนูููุงุช</h2>
            
            <section style="margin-bottom: 20px;">
                <h3 style="color: var(--danger);">โ๏ธ ุชูุจูู ูุงู ูุจู ุงูุจุฏุก</h3>
                <p>ูุง ูููู ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุญุณุงุจ ูู ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุญุงู ูุณูุงูููุ ููุฌุจ ุฃู ุชุชุฃูุฏ ูุจู ุฃู ุดูุก ุจุนุฏ ุชุณุฌูู ุญุณุงุจู ูุงูุฏุฎููุ ููุจู ุฃู ุชุถูู ุจูุงูุงุชุ ุงุถุบุท ุฎุฑูุฌ ูุฌุฑุจ ุฅุฏุฎุงู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ ูุฑุฉ ุฃุฎุฑู ูุชุชุฃูุฏ ูู ูุนุฑูุชู ููู.</p>
            </section>

            <section style="margin-bottom: 20px;">
                <h3>๐๏ธ ุฅุนุฏุงุฏ ุงูุญุณุงุจุงุช ูุงููุชุนุงูููู ูุงููุฎุฒู</h3>
                <ul style="list-style-type: square; padding-right: 20px;">
                    <li><strong>ุฏููู ุงูุญุณุงุจุงุช:</strong> ุฃุถู ุงูุญุณุงุจุงุช ุนู ุทุฑูู ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ูุฅุฏุฎุงู ุงุณูู ูููุนู (ุฅุฏุฎุงู ุงูููุน ุจุทุฑููุฉ ุตุญูุญุฉ ูุคุซุฑ ุนูู ุนุฑุถ ุงูููุงุฆู ูุงูุชูุงุฑูุฑ).</li>
                    <li><strong>ุงููุฎุฒู:</strong> ููููู ุฅุถุงูุฉ ููุชุฌ ุฃู ุตูู ุนู ุทุฑูู ุงูููุฑ ุนูู "ุตูู ุฌุฏูุฏ" ููุชุงุจุฉ ุงุณูู ูุณุนุฑูุ ููุญุจุฐ ุนูู ููุฏ ุงูุชุชุงุญู ููุตูู ุฅู ูุงู ูู ุฑุตูุฏ ุฃูู ุงููุชุฑุฉ.</li>
                    <li><strong>ุงููุชุนุงูููู:</strong> ููููู ุฅุถุงูุฉ ุจูุงูุงุช ูุชุนุงูู ุนู ุทุฑูู ุงูููุฑ ุนูููุง ููุชุงุจุฉ ุงุณูู ูุฑูู ุงููุงุชู ูููุงุญุธุงุช ุฅู ูุฌุฏ.</li>
                    <li><strong>ุงูุจุญุซ ูุงูุงุณุชูุฑุงุฏ:</strong> ูุชุงุญ ุงุณุชูุฑุงุฏ ูุชุตุฏูุฑ ูุงูุจุญุซ ุฏุงุฎู ุนูุงุตุฑ ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ.</li>
                </ul>
            </section>

            <section style="margin-bottom: 20px;">
                <h3>๐ ุชุณุฌูู ูููุฏ ุงูููููุฉ</h3>
                <ul style="list-style-type: square; padding-right: 20px;">
                    <li><strong>ุฅูุดุงุก ุงูููุฏ:</strong> ุงุถุบุท ุนูู "ููุฏ ุฌุฏูุฏ" ูุงุฏุฎู ุงูุชุงุฑูุฎ ูุงุฎุชูุงุฑ ุงูุญุณุงุจ ุงููุฏูู ูุงูุฏุงุฆู (ููุตุญ ุจุชุณุฌููู ูู ุฏููู ุงูุญุณุงุจุงุช ุฃููุงู ููู ูุธูุฑ ูู ูู ูุงุฆูุฉ ููุณุฏูุฉ).</li>
                    <li><strong>ุงูุฃุณูุงุก ูุงูุฃุตูุงู:</strong> ุฎุงูุฉ ุงูุงุณู ููุชุจ ูููุง ุงุณู ุงูููุชุนุงูู ูุนูุ ูููููู ุงุฎุชูุงุฑ ุงูุตูู ุฃู ุงูููุชุฌ ููุง ุชู ุชุณุฌููู ูุณุจูุงู.</li>
                    <li><strong>ุงูุฅุถุงูุฉ ุงูุจูููุฉ:</strong> ูููู ุงูุฅุถุงูุฉ ุจูู ุงูุตููู ุนู ุทุฑูู ุงูููุฑ ุนูู ุนูุงูุฉ (<strong>+</strong>).</li>
<li><strong>ุงููููุฏ ุงููุฑูุจุฉ:</strong> ูุชุณุฌูู ููุฏ "ูุฐููุฑูู"ุ ูู ุจุชูุณูู ุงูููุฏ ุจุญูุซ ุชุถุน **ูู ุญุณุงุจ ูู ุณุทุฑ ูุณุชูู**ุ ุงูุชุจ ุงุณู ุงูุญุณุงุจ ูู ุฎุงูุชู (ูุฏูู ุฃู ุฏุงุฆู) ูุถุน ุงููุจูุบ ุฃูุงููุ ูุน ุชุฑู ุงูุฎุงูุฉ ุงูุฃุฎุฑู **ูุงุฑุบุฉ**.</li>
                    <li><strong>ุงูุฌุฑุฏ ุงููุณุชูุฑ:</strong> ุชุนูู ูููุฏ ุงูููููุฉ ุจูุธุงู ุงูุฌุฑุฏ ุงููุณุชูุฑุ ููู ุงูุจูุน ูุงูุดุฑุงุก ูุชู ุงุณุชุนูุงู ุญุณุงุจ ุงููุจูุนุงุช ูุชูููุฉ ุงูุจุถุงุนุฉ ูุงููุฎุฒูู ุจุดูู ุฑุฆูุณู.</li>
                    <li><strong>ุงูุชุฃุซูุฑุงุช ุงูุขููุฉ:</strong> ูููุฉ ุงูุตูู ุชุชุฃุซุฑ ุจุงูุญุณุงุจุงุช ุงูุชู ููุนูุง "ูุฎุฒูู"ุ ููุฏููููุฉ ุงููุชุนุงูู ุชูุญุฏุฏ ุจุญุณุจ ุงูุญุณุงุจุงุช ุงูุชู ููุนูุง "ูุฏูููู" ุฃู "ุฏุงุฆููู".</li>
<li><strong>ุชุญุฏูุซ ุงูุจูุงูุงุช:</strong> ุชูุจูู: ูู ุญุงู ุชุนุฏูู ููุณ ุงูููู ูุฅุนุงุฏุฉ ุฑูุนูุ ูุฑุฌู ุชุบููุฑ ุงุณู ุงูููู ุฃู ุชุญุฏูุซ ุงูุตูุญุฉ ูุถูุงู ูุฑุงุกุฉ ุงูุจูุงูุงุช Excel.</li>
<li><strong>ุชุทุงุจู ุงููุณููุงุช:</strong> ุชูุจูู: ูุฌุจ ุฃู ุชููู ุฃุณูุงุก ุงูุญุณุงุจุงุช ูู ุฏูุชุฑ ุงูููููุฉ ูุทุงุจูุฉ ุชูุงูุงู ููุฏููู (ุงูุชุจู ูููุฑูู ุจูู "ุฉ" ู "ูู" ูุงููุณุงูุงุช).</li>
<li><strong>ุทุจูุนุฉ ุงูุญุณุงุจุงุช:</strong> ุชูุจูู: ูุฌุจ ูุฑุงุฌุนุฉ ุทุจูุนุฉ ุงูุญุณุงุจุงุช ูู ููุฒุงู ุงููุฑุงุฌุนุฉ ูุงูุชุฃูุฏ ูู ุธููุฑ ุงูุฃุตูู ูุงููุตุฑููุงุช ูุฑุตูุฏ ููุงุฆู ูุฏููุ ูุงูุฎุตูู ูุงูุฅูุฑุงุฏุงุช ูุญููู ุงูููููุฉ ูุฑุตูุฏ ููุงุฆู ุฏุงุฆู.</li>
<li><strong>ุชูุธูู ุงููููุฏ ูุงููุฎุฒู:</strong> ุชูุจูู: ูุฑุฌู ุงูุถุบุท ุนูู ุฃููููุฉ ุงููุฎุฒู (๐ฆ) ูุฅุซุจุงุช ุงูุฃุตูุงู ูุงููููุงุช ุญุงู ุงูุงุญุชูุงุฌุ ูุงุณุชุฎุฏุงู ุฃููููุฉ ุงูุชูููู (๐จ) ูุชูููุฒ ุงููููุฏ ุจุตุฑูุงูุ ูุน ุฃูููุฉ ุชุฏููู ุฑูู ุงูููุฏ ูุงูููุงุญุธุงุช ูุณูููุฉ ุงูุจุญุซ ูุงูุชุนูุจ.</li>
                </ul>
            </section>

            <section style="margin-bottom: 20px; background: #f1f5f9; padding: 15px; border-radius: 8px;">
                <h3>๐ ุงูุชูุงุฑูุฑ ุงูุฎุชุงููุฉ</h3>
                <p>ููุฒุงู ุงููุฑุงุฌุนุฉ ููุงุฆูุฉ ุงูุฏุฎู ูุงููุฑูุฒ ุงููุงูู ูู ุชูุงุฑูุฑ <strong>ุขููุฉ</strong> ููุนุฑุถ ููุทุ ูููุฑุญู ุฅูููู ุงูููุงุณุจ ุชููุงุฆูุงู. ููููู ุฃูุถุงู ุฅุฏุฎุงู ูููุฏ ุงูุฌุฑุฏ ูุงูุฅููุงู ุจุณูุงุณุฉ.</p>
                <p style="font-weight: bold; color: var(--success);">๐ก ููุงุญุธุฉ ูุงูุฉ: ุจุนุฏ ุงูุงูุชูุงุก ูู ุฅุฏุฎุงู ุจูุงูุงุชู ุงุถุบุท "ุญูุธ ุงูุจูุงูุงุช" ููู ุชุฌุฏูุง ุนูุฏ ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู.</p>
            </section>

            <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 30px 0;">

            <footer style="font-size: 13px; color: #64748b; text-align: center;">
                <p>"ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ 2026 ููุฃุณุชุงุฐ: <strong>ูุงููู ูุงูุฑ  </strong>. ููููุน ููุนุงู ุจุงุชุงู ุฅุนุงุฏุฉ ููุฏุณุฉ ุงูููุฏ ุงูุจุฑูุฌู ุฃู ุงุณุชุฎุฏุงูู ูุฃุบุฑุงุถ ุชุฌุงุฑูุฉ ุฏูู ุฅุฐู ูุชุงุจู ูุณุจู. ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ุจุญุฑุต ูุถูุงู ุงุณุชูุฑุงุฑ ุงูุฃุฏุงุกุ ููุจุฐู ุงููุจุฑูุฌ ุฃูุตู ุฌูุฏ ูุชุฃููู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุชูููุงุช ุชุดููุฑ ูุชุทูุฑุฉุ ููุน ุฐููุ ูุง ูุชุญูู ุงููุจุฑูุฌ ุงููุณุคูููุฉ ุนู ุฃู ููุฏุงู ุฃู ุณุฑูุฉ ุจูุงูุงุช ูุงุชุฌุฉ ุนู ุฅููุงู ุงููุณุชุฎุฏู ูู ุงูุญูุงุธ ุนูู ูููุฉ ุงููุฑูุฑุ ุฃู ุงุณุชุฎุฏุงู ุฃุฌูุฒุฉ ุบูุฑ ูุญููุฉ ุฃู ูุชุตูุญุงุช ุบูุฑ ูุญุฏุซุฉุ ุฃู ุจุณุจุจ ูุฌูุงุช ุฅููุชุฑูููุฉ ุฎุงุฑุฌุฉ ุนู ุญุฏูุฏ ุงูุญูุงูุฉ ุงูุจุฑูุฌูุฉ ุงููุชุจุนุฉ."</p>
                <p style="font-weight: bold;">ุงููุณุฎุฉ ุงูุฃุตููุฉ ููุคููุฉ ุจุงููุงูู ยฉ 2026 2026</p>
            </footer>
        </div>
    </div>
</div>

<datalist id="accList"></datalist>
<datalist id="partnerList"></datalist>

<script type="module">
    const _0xTarget = atob('bWljaGFlbG1haGVyOTIzLWN5YmVyLmdpdGh1Yi5pbw==');
    if (window.location.hostname !== _0xTarget) {
        document.body.innerHTML = '<div style="direction:rtl;text-align:center;padding:50px;font-family:sans-serif;"><h2>โ๏ธ ูุณุฎุฉ ุบูุฑ ูุฑุฎุตุฉ ุฅูุง ุนูู ุงูุฑุงุจุท ุงูุฃุตูู              ุฃ ูุงููู ูุงูุฑ</h2></div>';
        window.stop();
    }

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const config = {
        apiKey: "AIzaSyBP7HP1w4MbOFZWnv7BdpKwDlYjv4VJUTM",
        authDomain: "accountsite26.firebaseapp.com",
        databaseURL: "https://accountsite26-default-rtdb.firebaseio.com",
        projectId: "accountsite26",
        storageBucket: "accountsite26.firebasestorage.app",
        messagingSenderId: "1015795938039",
        appId: "1:1015795938039:web:b625e24fca2c5b231d19f2"
    };

    const app = initializeApp(config);
    const db = getDatabase(app);
    const auth = getAuth(app);

    window.switchAuth = (isLogin) => {
        document.getElementById('loginTab').classList.toggle('active', isLogin);
        document.getElementById('registerTab').classList.toggle('active', !isLogin);
        document.querySelector('.auth-box .btn-save').innerText = isLogin ? 'ุฏุฎูู' : 'ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ';
    };

    window.processAuth = async () => {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value.trim();
        const inputCode = document.getElementById('activationCode').value.trim();
        const isLogin = document.getElementById('loginTab').classList.contains('active');
        if(!u || !p || !inputCode) return alert("โ๏ธ ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ ูููุฏ ุงูุชุญูู");
        document.getElementById('loader').style.display = 'flex';
        try {
            const configSnapshot = await get(ref(db, `systemConfig/weeklyCode`));
            const correctCode = configSnapshot.exists() ? configSnapshot.val().toString() : "";
            if (inputCode !== correctCode) {
                document.getElementById('loader').style.display = 'none';
                return alert("โ ููุฏ ุงูุชุญูู (ุงูููุชุงุญ) ุบูุฑ ุตุญูุญ!");
            }
            localStorage.setItem('user_display_name', u); 
            const safeUser = btoa(unescape(encodeURIComponent(u))).replace(/[/+=]/g, "").toLowerCase().substring(0, 15);
            const email = safeUser + "@maher-system.com";
            if (isLogin) { await signInWithEmailAndPassword(auth, email, p); } 
            else { await createUserWithEmailAndPassword(auth, email, p); alert("โ ุชู ุงูุชุณุฌูู ุจูุฌุงุญ"); }
        } catch (e) {
            alert("ุญุฏุซ ุฎุทุฃ ูู ุงูุจูุงูุงุช");
            document.getElementById('loader').style.display = 'none';
        }
    };

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const savedName = localStorage.getItem('user_display_name');
            window.currentUser = savedName || user.email.split('@')[0];
            const snapshot = await get(ref(db, `users/${user.uid}/data`));
            const data = snapshot.exists() ? snapshot.val() : {};
            window.userDB = { accounts: data.accounts || [], journal: data.journal || [], products: data.products || [], partnersInfo: data.partnersInfo || [] };
            startApp();
        }
    });

    window.syncToCloud = async () => {
        if(!auth.currentUser) return;
        document.getElementById('loader').style.display = 'flex';
        try { await set(ref(db, `users/${auth.currentUser.uid}/data`), window.userDB); alert("โ ุชู ุงูุญูุธ ุจูุฌุงุญ"); } 
        catch (e) { alert("โ ูุดู ุงูุญูุธ"); }
        document.getElementById('loader').style.display = 'none';
    };

    window.logout = () => { signOut(auth).then(() => location.reload()); };
</script>

<script>
    (function(){
        const _0xK3 = ["ุฃุตูู", "ุงูุชุฒุงูุงุช", "ุญููู ููููุฉ", "ูุจูุนุงุช", "ุชูููุฉ ูุจูุนุงุช", "ูุตุฑููุงุช", "ุฅูุฑุงุฏุงุช", "ูุฎุฒูู", "ูุฏูููู", "ุฏุงุฆููู", "ุบูุฑ ุฐูู"];

        window.startApp = function() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'block';
            document.getElementById('loader').style.display = 'none';
            document.getElementById('userDisplay').innerText = "๐ค " + currentUser;
            updateDatalists(); openPage('homePage');
        };

        window.openPage = function(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            render(id);
        };

        // ุฏุงูุฉ ุงูุจุญุซ ุงูุฐูู ูุน ุงูุชุธููู
        window.tableSearch = function(bodyId, query) {
            const rows = document.getElementById(bodyId).rows;
            const q = query.toLowerCase();
            for (let i = 0; i < rows.length; i++) {
                let found = false;
                for (let j = 0; j < rows[i].cells.length; j++) {
                    const cell = rows[i].cells[j];
                    const input = cell.querySelector('input');
                    const text = input ? input.value.toLowerCase() : cell.textContent.toLowerCase();
                    if (q && text.includes(q)) {
                        cell.classList.add('highlight');
                    } else {
                        cell.classList.remove('highlight');
                    }
                }
            }
        };

        // ุชุตุฏูุฑ ุงูุจูุงูุงุช ุฅูู Excel ูุจุงุดุฑุฉ ูู JSON
        window.exportData = function(key) {
            let data = [];
            if(key === 'accounts') data = userDB.accounts;
            else if(key === 'journal') data = userDB.journal;
            else if(key === 'products') data = userDB.products;
            else if(key === 'partners') data = userDB.partnersInfo;
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Data");
            XLSX.writeFile(wb, `${key}.xlsx`);
        };

        // ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ูู Excel
        window.importData = function(input, key) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(worksheet);
                
                if(key === 'accounts') userDB.accounts = json;
                else if(key === 'journal') userDB.journal = json;
                else if(key === 'products') userDB.products = json;
                else if(key === 'partners') userDB.partnersInfo = json;
                
                render(key + 'Page');
                updateDatalists();
                alert("ุชู ุงูุงุณุชูุฑุงุฏ ุจูุฌุงุญ");
            };
            reader.readAsArrayBuffer(file);
        };

        // ุชุตุฏูุฑ ุฌุฏูู HTML (ููุชูุงุฑูุฑ)
        window.exportTableToExcel = function(id, name) {
            const table = document.getElementById(id);
            const wb = XLSX.utils.table_to_book(table);
            XLSX.writeFile(wb, `${name}.xlsx`);
        };

        window.exportBalanceSheet = function() {
            const a = document.getElementById('assetsBody');
            const l = document.getElementById('liabilitiesBody');
            const wb = XLSX.utils.book_new();
            const ws1 = XLSX.utils.table_to_sheet(a);
            const ws2 = XLSX.utils.table_to_sheet(l);
            XLSX.utils.book_append_sheet(wb, ws1, "Assets");
            XLSX.utils.book_append_sheet(wb, ws2, "Liabilities");
            XLSX.writeFile(wb, "ุงููุฑูุฒ_ุงููุงูู.xlsx");
        };

        window.updateDatalists = function() {
            const dl = document.getElementById('accList'); dl.innerHTML = '';
            userDB.accounts.forEach(a => { if(a.name) dl.innerHTML += `<option value="${a.name}">`; });
            const pl = document.getElementById('partnerList'); pl.innerHTML = '';
            userDB.partnersInfo.forEach(p => { if(p.name) pl.innerHTML += `<option value="${p.name}">`; });
        };

        window.getTrialBalances = function(fromDate = null, toDate = null) {
            let accs = {};
            userDB.accounts.forEach(a => { if(a.name) accs[a.name] = { d: 0, c: 0, type: a.type }; });
            userDB.journal.forEach(j => {
                if (fromDate && j.date < fromDate) return;
                if (toDate && j.date > toDate) return;
                if(accs[j.deb]) accs[j.deb].d += parseFloat(j.v) || 0;
                if(accs[j.cre]) accs[j.cre].c += parseFloat(j.v) || 0;
            });
            let res = [];
            for(let n in accs) {
                let bal = accs[n].d - accs[n].c;
                res.push({ name: n, type: accs[n].type, balance: bal, d: accs[n].d, c: accs[n].c });
            }
            return res;
        };

        window.calculateNetProfit = function(fromDate = null, toDate = null) {
            let b = getTrialBalances(fromDate, toDate);
            let s = (t) => b.filter(a => a.type === t).reduce((x, a) => x + Math.abs(a.balance), 0);
            return (s('ูุจูุนุงุช') - s('ุชูููุฉ ูุจูุนุงุช')) + s('ุฅูุฑุงุฏุงุช') - s('ูุตุฑููุงุช');
        };

        window.insertRow = function(target, index) {
            if(target === 'acc') userDB.accounts.splice(index + 1, 0, {name:'', type:'ุฃุตูู'});
            if(target === 'jou') userDB.journal.splice(index + 1, 0, {ref:'', date: new Date().toISOString().split('T')[0], q:0, v:0, deb:'', cre:'', name:'', prod:'', note:'', isBlue: false, showExtra: false});
            if(target === 'prod') userDB.products.splice(index + 1, 0, {name:'', price:0});
            if(target === 'part') userDB.partnersInfo.splice(index + 1, 0, {name:'', phone:'', note:''});
            render(document.querySelector('.page.active').id);
        };

        window.render = function(id) {
            if(id === 'accountsPage') {
                const b = document.getElementById('accountsBody'); b.innerHTML = '';
                userDB.accounts.forEach((a, i) => {
                    let o = _0xK3.map(t => `<option ${a.type==t?'selected':''}>${t}</option>`).join('');
                    b.innerHTML += `<tr><td><input value="${a.name||''}" onchange="userDB.accounts[${i}].name=this.value;updateDatalists()"></td><td><select onchange="userDB.accounts[${i}].type=this.value">${o}</select></td><td><button class="btn btn-ins" onclick="insertRow('acc', ${i})">โ</button><button class="btn btn-del" onclick="userDB.accounts.splice(${i},1);render('accountsPage')">๐๏ธ</button></td></tr>`;
                });
            }
            if(id === 'journalPage') {
                const b = document.getElementById('journalBody'); b.innerHTML = '';
                let colorCounter = 0; 
                userDB.journal.forEach((j, i) => {
                    let rowClass = '';
                    if(j.isBlue) {
                        colorCounter++;
                        rowClass = (colorCounter % 2 !== 0) ? 'row-blue' : 'row-green';
                    }
                    let extraStyle = j.showExtra ? 'table-row' : 'none';
                    let btnColor = j.isBlue ? (rowClass === 'row-blue' ? 'var(--blue-row)' : 'var(--green-row)') : ''; 
                    let pO = `<option value="">-- ุตูู --</option>` + userDB.products.map(p => `<option value="${p.name}" ${j.prod===p.name?'selected':''}>${p.name}</option>`).join('');
                    b.innerHTML += `
                    <tr class="${rowClass}">
                        <td><input type="text" placeholder="ุฑูู" value="${j.ref||''}" onchange="userDB.journal[${i}].ref=this.value"></td>
                        <td><input type="date" value="${j.date||''}" onchange="userDB.journal[${i}].date=this.value"></td>
                        <td><input list="accList" value="${j.deb||''}" onchange="userDB.journal[${i}].deb=this.value"></td>
                        <td><input list="accList" value="${j.cre||''}" onchange="checkSalesReminder(${i}, this.value)"></td>
                        <td><input list="partnerList" value="${j.name||''}" onchange="userDB.journal[${i}].name=this.value"></td>
                        <td><input type="number" id="v${i}" value="${j.v||0}" oninput="userDB.journal[${i}].v=this.value"></td>
                        <td><input type="text" placeholder="ููุงุญุธุฉ" value="${j.note||''}" onchange="userDB.journal[${i}].note=this.value"></td>
                        <td style="white-space:nowrap">
                            <button title="ุชูุงุตูู ุงูุตูู" onclick="userDB.journal[${i}].showExtra=!userDB.journal[${i}].showExtra;render('journalPage')" style="cursor:pointer; background:${j.showExtra?'#cbd5e1':''}">๐ฆ</button>
                            <button title="ุชูููุฒ ุงูููุฏ" onclick="userDB.journal[${i}].isBlue=!userDB.journal[${i}].isBlue;render('journalPage')" style="cursor:pointer; background:${btnColor}">๐จ</button>
                            <button class="btn btn-ins" onclick="insertRow('jou', ${i})">โ</button>
                            <button class="btn btn-del" onclick="userDB.journal.splice(${i},1);render('journalPage')">๐๏ธ</button>
                        </td>
                    </tr>
                    <tr class="${rowClass}" style="display:${extraStyle};">
                        <td colspan="3" style="text-align:left;">ุงูุตูู: <select style="width:65%" onchange="updateRowPrice(${i}, this.value)">${pO}</select></td>
                        <td colspan="2">ุณุนุฑ ุงููุญุฏุฉ: <input type="number" style="width:80px" id="p${i}" value="${j.unitPrice || 0}" oninput="calcRowVal(${i})"></td>
                        <td colspan="3" style="text-align:right;">ุงููููุฉ: <input type="number" style="width:80px" id="q${i}" value="${j.q||0}" oninput="validateStock(${i})"></td>
                    </tr>`;
                });
            }
            if(id === 'partnersPage') {
                const b = document.getElementById('partnersBody'); b.innerHTML = '';
                let pC = {};
                userDB.journal.forEach(j => {
                    if(j.name) {
                        let n = j.name.trim(); if(!pC[n]) pC[n] = { d: 0, c: 0 };
                        let v = parseFloat(j.v) || 0;
                        let debAcc = userDB.accounts.find(a => a.name === j.deb);
                        let creAcc = userDB.accounts.find(a => a.name === j.cre);
                        if(debAcc && ["ูุฏูููู", "ุฏุงุฆููู"].includes(debAcc.type)) pC[n].d += v;
                        if(creAcc && ["ูุฏูููู", "ุฏุงุฆููู"].includes(creAcc.type)) pC[n].c += v;
                    }
                });
                userDB.partnersInfo.forEach((p, i) => {
                    let d = pC[p.name] ? pC[p.name].d : 0, c = pC[p.name] ? pC[p.name].c : 0, net = d - c;
                    b.innerHTML += `<tr>
                        <td><input value="${p.name||''}" onchange="userDB.partnersInfo[${i}].name=this.value;updateDatalists()"></td>
                        <td><input value="${p.phone||''}" onchange="userDB.partnersInfo[${i}].phone=this.value"></td>
                        <td><input value="${p.note||''}" onchange="userDB.partnersInfo[${i}].note=this.value"></td>
                        <td style="color:blue">${d}</td>
                        <td style="color:orange">${c}</td>
                        <td style="font-weight:bold; color:${net>=0?'green':'red'}">${net}</td>
                        <td style="white-space:nowrap">
                            <button title="ูุดู ุญุณุงุจ" onclick="viewStatement('${p.name}')" style="cursor:pointer; background:#e2e8f0; border:1px solid #94a3b8; border-radius:4px; padding:4px 8px;">๐จ๏ธ</button>
                            <button class="btn btn-ins" onclick="insertRow('part', ${i})">โ</button>
                            <button class="btn btn-del" onclick="userDB.partnersInfo.splice(${i},1);render('partnersPage')">๐๏ธ</button>
                        </td></tr>`;
                });
            }
            if(id === 'trialPage') {
                const b = document.getElementById('trialBody'); b.innerHTML = '';
                getTrialBalances().forEach(a => { b.innerHTML += `<tr><td class="trial-blue">${a.name}</td><td>${a.d}</td><td>${a.c}</td><td class="trial-blue">${a.balance>0?a.balance:0}</td><td class="trial-blue">${a.balance<0?Math.abs(a.balance):0}</td></tr>`; });
            }
            if(id === 'incomePage') {
                const b = document.getElementById('incomeBody'); b.innerHTML = '';
                const pageContainer = document.getElementById('incomePage');
                if(!document.getElementById('dateFilterContainer')) {
                    const filterHtml = `
                    <div id="dateFilterContainer" class="search-container" style="background:#e2e8f0; padding:15px; border-radius:8px; margin-bottom:20px;">
                        <label><b>ูู ุชุงุฑูุฎ:</b> <input type="date" id="incomeFrom" style="width:150px" onchange="render('incomePage')"></label>
                        <label><b>ุฅูู ุชุงุฑูุฎ:</b> <input type="date" id="incomeTo" style="width:150px" onchange="render('incomePage')"></label>
                        <button class="btn btn-excel" onclick="exportTableToExcel('incomeBody', 'ูุงุฆูุฉ_ุงูุฏุฎู_ุงูุชูุตูููุฉ')">ุชุตุฏูุฑ Excel</button>
                    </div>`;
                    pageContainer.insertBefore(document.createRange().createContextualFragment(filterHtml), pageContainer.children[1]);
                }
                let fDate = document.getElementById('incomeFrom').value;
                let tDate = document.getElementById('incomeTo').value;
                let bl = getTrialBalances(fDate, tDate);
                let sm = (t) => bl.filter(a => a.type === t).reduce((s, a) => s + Math.abs(a.balance), 0);
                let m = sm('ูุจูุนุงุช'), c = sm('ุชูููุฉ ูุจูุนุงุช'), r = m - c, oR = sm('ุฅูุฑุงุฏุงุช'), oE = sm('ูุตุฑููุงุช'), n = r + oR - oE;
                let resText = n >= 0 ? "ุตุงูู ุงูุฑุจุญ" : "ุตุงูู ุงูุฎุณุงุฑุฉ";
                let resColor = n >= 0 ? "#dcfce7" : "#fee2e2";
                b.innerHTML = `
                    <tr><th colspan="2" style="background:var(--main); color:white; padding:10px;">ุงูููุฎุต ุงูุนุงู ูููุชุฑุฉ</th></tr>
                    <tr><td>ุฅุฌูุงูู ุงููุจูุนุงุช</td><td>${m}</td></tr>
                    <tr><td>(-) ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ</td><td>${c}</td></tr>
                    <tr class="total-row"><td>ูุฌูู ุงูุฑุจุญ</td><td>${r}</td></tr>
                    <tr><td>(+) ุฅูุฑุงุฏุงุช ุฃุฎุฑู</td><td>${oR}</td></tr>
                    <tr><td>(-) ูุตุฑููุงุช ุฅุฏุงุฑูุฉ ูุนููููุฉ</td><td>${oE}</td></tr>
                    <tr class="total-row" style="background:${resColor};"><td>${resText}</td><td>${n}</td></tr>
                    <tr><td colspan="2" style="height:20px;"></td></tr>
                    <tr><th colspan="2" style="background:var(--accent); color:white; padding:10px;">ุชุญููู ุฑุจุญูุฉ ุงูููุชุฌุงุช (ุฃุฑุจุงุญ ูู ุตูู)</th></tr>
                    <tr style="background:#f1f5f9; font-weight:bold;"><td>ุงุณู ุงูุตูู / ุงูููุชุฌ</td><td>ุตุงูู ุงูุฑุจุญ ุงููุญูู</td></tr>
                `;
                let prodProfits = {};
                userDB.journal.forEach(j => {
                    if (fDate && j.date < fDate) return;
                    if (tDate && j.date > tDate) return;
                    if (!j.prod) return;
                    if (!prodProfits[j.prod]) prodProfits[j.prod] = 0;
                    let debAcc = userDB.accounts.find(a => a.name === j.deb);
                    let creAcc = userDB.accounts.find(a => a.name === j.cre);
                    if (creAcc && creAcc.type === "ูุจูุนุงุช") prodProfits[j.prod] += (parseFloat(j.v) || 0);
                    if (debAcc && debAcc.type === "ุชูููุฉ ูุจูุนุงุช") prodProfits[j.prod] -= (parseFloat(j.v) || 0);
                });
                for (let pName in prodProfits) {
                    let prof = prodProfits[pName];
                    b.innerHTML += `<tr><td>${pName}</td><td style="font-weight:bold; color:${prof>=0?'green':'red'}">${prof}</td></tr>`;
                }
            }
            if(id === 'balanceSheetPage') {
                let bl = getTrialBalances(), ab = document.getElementById('assetsBody'), lb = document.getElementById('liabilitiesBody');
                ab.innerHTML = ''; lb.innerHTML = ''; let tA = 0, tL = 0;
                bl.forEach(a => {
                    if((['ุฃุตูู', 'ูุฎุฒูู', 'ูุฏูููู'].includes(a.type)) && a.balance > 0) { let v = a.balance; tA += v; ab.innerHTML += `<tr><td>${a.name}</td><td>${v}</td></tr>`; }
                    if((['ุงูุชุฒุงูุงุช', 'ุญููู ููููุฉ', 'ุฏุงุฆููู'].includes(a.type)) && a.balance < 0) { let v = Math.abs(a.balance); tL += v; lb.innerHTML += `<tr><td>${a.name}</td><td>${v}</td></tr>`; }
                });
                let nt = calculateNetProfit(); tL += nt;
                let resText = nt >= 0 ? "ุตุงูู ุงูุฑุจุญ" : "ุตุงูู ุงูุฎุณุงุฑุฉ";
                let textColor = nt >= 0 ? "var(--success)" : "var(--danger)";
                lb.innerHTML += `<tr style="background:#f0fdf4; font-weight:bold; color:${textColor}"><td>${resText}</td><td>${nt}</td></tr><tr class="total-row"><td>ุงูุฅุฌูุงูู</td><td>${tA}</td></tr>`;
                ab.innerHTML += `<tr class="total-row"><td>ุงูุฅุฌูุงูู</td><td>${tA}</td></tr>`;
                const finalRow = lb.querySelector('tr:last-child td:last-child');
                if(finalRow) finalRow.innerText = tL;
            }
            if(id === 'productsPage') {
                const b = document.getElementById('productsBody'); b.innerHTML = '';
                userDB.products.forEach((p, i) => {
                    let win = 0, out = 0;
                    userDB.journal.forEach(j => {
                        if(j.prod === p.name){
                            let debAcc = userDB.accounts.find(a => a.name === j.deb);
                            let creAcc = userDB.accounts.find(a => a.name === j.cre);
                            if(debAcc && debAcc.type === "ูุฎุฒูู") win += parseFloat(j.q) || 0;
                            if(creAcc && creAcc.type === "ูุฎุฒูู") out += parseFloat(j.q) || 0;
                        }
                    });
                    b.innerHTML += `<tr><td><input value="${p.name||''}" onchange="userDB.products[${i}].name=this.value"></td><td><input type="number" value="${p.price||0}" onchange="userDB.products[${i}].price=this.value"></td><td>${win}</td><td>${out}</td><td style="font-weight:bold">${win - out}</td><td><button class="btn btn-ins" onclick="insertRow('prod', ${i})">โ</button><button class="btn btn-del" onclick="userDB.products.splice(${i},1);render('productsPage')">๐๏ธ</button></td></tr>`;
                });
            }
        };

        window.checkSalesReminder = function(i, val) {
            userDB.journal[i].cre = val;
            let creAcc = userDB.accounts.find(a => a.name === val);
            if(creAcc && creAcc.type === "ูุจูุนุงุช") alert("๐ ุชูุจูู: ูุฌุจ ุนูู ููุฏ ุฅุซุจุงุช ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ.");
        };

        window.validateStock = function(i) {
            let j = userDB.journal[i];
            let creAcc = userDB.accounts.find(a => a.name === j.cre);
            if(creAcc && creAcc.type === "ูุฎุฒูู" && j.prod) {
                let cur = 0;
                userDB.journal.forEach((jj, idx) => {
                    if(idx !== i && jj.prod === j.prod) {
                        let dAcc = userDB.accounts.find(a => a.name === jj.deb);
                        let cAcc = userDB.accounts.find(a => a.name === jj.cre);
                        if(dAcc && dAcc.type === "ูุฎุฒูู") cur += parseFloat(jj.q)||0;
                        if(cAcc && cAcc.type === "ูุฎุฒูู") cur -= parseFloat(jj.q)||0;
                    }
                });
                if(parseFloat(document.getElementById('q'+i).value) > cur) { alert("ุงููุชุงุญ: " + cur); document.getElementById('q'+i).value = 0; }
            }
            calcRowVal(i);
        };

        window.updateRowPrice = function(i, n) {
            const p = userDB.products.find(x => x.name === n);
            userDB.journal[i].prod = n;
            if(p) { 
                document.getElementById('p'+i).value = p.price || 0;
                userDB.journal[i].unitPrice = p.price || 0;
                calcRowVal(i); 
            }
        };

        window.calcRowVal = function(i) {
            userDB.journal[i].q = document.getElementById('q'+i).value || 0;
            userDB.journal[i].unitPrice = document.getElementById('p'+i).value || 0;
            let total = (parseFloat(userDB.journal[i].unitPrice) || 0) * (parseFloat(userDB.journal[i].q) || 0);
            document.getElementById('v'+i).value = total;
            userDB.journal[i].v = total;
        };

        window.addAcc = () => { userDB.accounts.push({name:'', type:'ุฃุตูู'}); render('accountsPage'); };
        window.addJ = () => { userDB.journal.push({ref:'', date: new Date().toISOString().split('T')[0], q:0, v:0, deb:'', cre:'', name:'', prod:'', note:'', isBlue: false, showExtra: false}); render('journalPage'); };
        window.addP = () => { userDB.products.push({name:'', price:0}); render('productsPage'); };
        window.addPartnerInfo = () => { userDB.partnersInfo.push({name:'', phone:'', note:''}); render('partnersPage'); };
                window.viewStatement = function(partnerName) {
            if(!partnerName) return alert("ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุชุนุงูู ุฃููุงู");
            openPage('statementPage');
            document.getElementById('stName').innerText = "ูุดู ุญุณุงุจ: " + partnerName;
            const b = document.getElementById('statementBody'); b.innerHTML = '';
            let runningBalance = 0;
            userDB.journal.filter(j => j.name && j.name.trim() === partnerName.trim())
            .sort((a, b) => new Date(a.date) - new Date(b.date))
            .forEach(j => {
                let v = parseFloat(j.v) || 0;
                let debAmt = 0, creAmt = 0;
                let debAcc = userDB.accounts.find(a => a.name === j.deb);
                let creAcc = userDB.accounts.find(a => a.name === j.cre);
                if(debAcc && ["ูุฏูููู", "ุฏุงุฆููู"].includes(debAcc.type)) debAmt = v;
                if(creAcc && ["ูุฏูููู", "ุฏุงุฆููู"].includes(creAcc.type)) creAmt = v;
                if(debAmt === 0 && creAmt === 0) return;
                runningBalance += (debAmt - creAmt);
                b.innerHTML += `<tr>
                    <td>${j.date || ''}</td>
                    <td>${j.ref || ''}</td>
                    <td style="text-align:right;">${j.note || ''} ${j.prod ? ' - ุตูู: '+j.prod : ''}</td>
                    <td style="color:blue">${debAmt > 0 ? debAmt : '-'}</td>
                    <td style="color:red">${creAmt > 0 ? creAmt : '-'}</td>
                    <td style="font-weight:bold; background:#f8fafc;">${runningBalance}</td>
                </tr>`;
            });
            if(b.innerHTML === '') b.innerHTML = '<tr><td colspan="6">ูุง ุชูุฌุฏ ูุนุงููุงุช ูุณุฌูุฉ ููุฐุง ุงูุงุณู</td></tr>';
        };
    })();
</script>
</body>
</html>